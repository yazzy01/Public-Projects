<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Portfolio API</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen">
  <nav class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex">
          <div class="flex-shrink-0 flex items-center">
            <h1 class="text-xl font-bold text-indigo-600">Portfolio Admin</h1>
          </div>
        </div>
        <div class="flex items-center">
          <button id="logout-btn" class="ml-4 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Logout
          </button>
        </div>
      </div>
    </div>
  </nav>

  <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
    <!-- Tabs -->
    <div class="border-b border-gray-200">
      <nav class="-mb-px flex space-x-8">
        <a href="#" class="tab-link active-tab" data-tab="profile">
          Profile
        </a>
        <a href="#" class="tab-link" data-tab="projects">
          Projects
        </a>
        <a href="#" class="tab-link" data-tab="skills">
          Skills
        </a>
        <a href="#" class="tab-link" data-tab="messages">
          Messages
        </a>
      </nav>
    </div>

    <!-- Tab Content -->
    <div class="py-6">
      <!-- Profile Tab -->
      <div id="profile-tab" class="tab-content">
        <div class="bg-white shadow overflow-hidden sm:rounded-lg">
          <div class="px-4 py-5 sm:px-6 flex justify-between">
            <div>
              <h3 class="text-lg leading-6 font-medium text-gray-900">Profile Information</h3>
              <p class="mt-1 max-w-2xl text-sm text-gray-500">Personal details and information</p>
            </div>
            <button id="edit-profile-btn" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              Edit Profile
            </button>
          </div>
          <div class="border-t border-gray-200">
            <dl id="profile-info">
              <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Full name</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="profile-name">Loading...</dd>
              </div>
              <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Email address</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="profile-email">Loading...</dd>
              </div>
              <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">About</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="profile-about">Loading...</dd>
              </div>
              <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Status</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="profile-status">Loading...</dd>
              </div>
            </dl>
          </div>
        </div>
      </div>

      <!-- Projects Tab -->
      <div id="projects-tab" class="tab-content hidden">
        <div class="bg-white shadow overflow-hidden sm:rounded-lg">
          <div class="px-4 py-5 sm:px-6 flex justify-between">
            <div>
              <h3 class="text-lg leading-6 font-medium text-gray-900">Projects</h3>
              <p class="mt-1 max-w-2xl text-sm text-gray-500">Your portfolio projects</p>
            </div>
            <button id="add-project-btn" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              Add Project
            </button>
          </div>
          <div class="border-t border-gray-200">
            <ul id="projects-list" class="divide-y divide-gray-200">
              <li class="px-4 py-4 flex items-center justify-between">
                <div class="flex items-center">
                  <div class="ml-3">
                    <p class="text-sm font-medium text-gray-900">Loading projects...</p>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Skills Tab -->
      <div id="skills-tab" class="tab-content hidden">
        <div class="bg-white shadow overflow-hidden sm:rounded-lg">
          <div class="px-4 py-5 sm:px-6 flex justify-between">
            <div>
              <h3 class="text-lg leading-6 font-medium text-gray-900">Skills</h3>
              <p class="mt-1 max-w-2xl text-sm text-gray-500">Your technical skills</p>
            </div>
            <button id="add-skill-btn" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              Add Skill
            </button>
          </div>
          <div class="border-t border-gray-200">
            <ul id="skills-list" class="divide-y divide-gray-200">
              <li class="px-4 py-4 flex items-center justify-between">
                <div class="flex items-center">
                  <div class="ml-3">
                    <p class="text-sm font-medium text-gray-900">Loading skills...</p>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Messages Tab -->
      <div id="messages-tab" class="tab-content hidden">
        <div class="bg-white shadow overflow-hidden sm:rounded-lg">
          <div class="px-4 py-5 sm:px-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Messages</h3>
            <p class="mt-1 max-w-2xl text-sm text-gray-500">Contact messages from visitors</p>
          </div>
          <div class="border-t border-gray-200">
            <ul id="messages-list" class="divide-y divide-gray-200">
              <li class="px-4 py-4">
                <div class="flex justify-between">
                  <p class="text-sm font-medium text-gray-900">Loading messages...</p>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals will be added here -->

  <script>
    // Check if user is authenticated
    document.addEventListener('DOMContentLoaded', () => {
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = '/login';
        return;
      }

      // Setup tab navigation
      const tabLinks = document.querySelectorAll('.tab-link');
      const tabContents = document.querySelectorAll('.tab-content');

      tabLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          
          // Remove active class from all tabs
          tabLinks.forEach(l => l.classList.remove('active-tab'));
          tabContents.forEach(c => c.classList.add('hidden'));
          
          // Add active class to current tab
          const tabId = link.getAttribute('data-tab');
          link.classList.add('active-tab');
          document.getElementById(`${tabId}-tab`).classList.remove('hidden');
          
          // Load data for the tab
          loadTabData(tabId);
        });
      });

      // Logout functionality
      document.getElementById('logout-btn').addEventListener('click', async () => {
        try {
          await fetch('/api/auth/logout', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          localStorage.removeItem('token');
          window.location.href = '/login';
        } catch (error) {
          console.error('Logout failed:', error);
        }
      });

      // Load initial tab data
      loadTabData('profile');
    });

    // Function to load data for each tab
    async function loadTabData(tabId) {
      const token = localStorage.getItem('token');
      
      switch(tabId) {
        case 'profile':
          try {
            const response = await fetch('/api/users', {
              headers: {
                'Authorization': `Bearer ${token}`
              }
            });
            
            if (!response.ok) {
              throw new Error('Failed to load profile data');
            }
            
            const users = await response.json();
            if (users.length > 0) {
              const user = users[0];
              document.getElementById('profile-name').textContent = user.name;
              document.getElementById('profile-email').textContent = user.email;
              document.getElementById('profile-about').textContent = user.about;
              document.getElementById('profile-status').textContent = user.status || 'Not set';
            } else {
              document.getElementById('profile-name').textContent = 'No profile found';
              document.getElementById('profile-email').textContent = 'No profile found';
              document.getElementById('profile-about').textContent = 'No profile found';
              document.getElementById('profile-status').textContent = 'No profile found';
            }
          } catch (error) {
            console.error('Error loading profile:', error);
          }
          break;
          
        case 'projects':
          try {
            const response = await fetch('/api/projects', {
              headers: {
                'Authorization': `Bearer ${token}`
              }
            });
            
            if (!response.ok) {
              throw new Error('Failed to load projects');
            }
            
            const projects = await response.json();
            const projectsList = document.getElementById('projects-list');
            
            if (projects.length === 0) {
              projectsList.innerHTML = '<li class="px-4 py-4">No projects found</li>';
              return;
            }
            
            projectsList.innerHTML = projects.map(project => `
              <li class="px-4 py-4 flex items-center justify-between">
                <div>
                  <p class="text-sm font-medium text-gray-900">${project.title}</p>
                  <p class="text-sm text-gray-500">${project.description.substring(0, 100)}...</p>
                </div>
                <div class="flex space-x-2">
                  <button class="edit-project-btn text-indigo-600 hover:text-indigo-900" data-id="${project._id}">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="delete-project-btn text-red-600 hover:text-red-900" data-id="${project._id}">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </li>
            `).join('');
          } catch (error) {
            console.error('Error loading projects:', error);
          }
          break;
          
        case 'skills':
          try {
            const response = await fetch('/api/skills', {
              headers: {
                'Authorization': `Bearer ${token}`
              }
            });
            
            if (!response.ok) {
              throw new Error('Failed to load skills');
            }
            
            const skills = await response.json();
            const skillsList = document.getElementById('skills-list');
            
            if (skills.length === 0) {
              skillsList.innerHTML = '<li class="px-4 py-4">No skills found</li>';
              return;
            }
            
            skillsList.innerHTML = skills.map(skill => `
              <li class="px-4 py-4 flex items-center justify-between">
                <div>
                  <p class="text-sm font-medium text-gray-900">${skill.name}</p>
                  <p class="text-sm text-gray-500">${skill.category}</p>
                </div>
                <div class="flex items-center">
                  <div class="mr-4">
                    <div class="flex items-center">
                      ${Array(5).fill().map((_, i) => 
                        `<svg class="w-4 h-4 ${i < skill.proficiency ? 'text-yellow-500' : 'text-gray-300'}" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                        </svg>`
                      ).join('')}
                    </div>
                  </div>
                  <div class="flex space-x-2">
                    <button class="edit-skill-btn text-indigo-600 hover:text-indigo-900" data-id="${skill._id}">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="delete-skill-btn text-red-600 hover:text-red-900" data-id="${skill._id}">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
              </li>
            `).join('');
          } catch (error) {
            console.error('Error loading skills:', error);
          }
          break;
          
        case 'messages':
          try {
            const response = await fetch('/api/contacts', {
              headers: {
                'Authorization': `Bearer ${token}`
              }
            });
            
            if (!response.ok) {
              throw new Error('Failed to load messages');
            }
            
            const messages = await response.json();
            const messagesList = document.getElementById('messages-list');
            
            if (messages.length === 0) {
              messagesList.innerHTML = '<li class="px-4 py-4">No messages found</li>';
              return;
            }
            
            messagesList.innerHTML = messages.map(message => `
              <li class="px-4 py-4 ${message.read ? '' : 'bg-blue-50'}">
                <div class="flex justify-between">
                  <p class="text-sm font-medium text-gray-900">${message.name} <span class="text-gray-500">&lt;${message.email}&gt;</span></p>
                  <p class="text-sm text-gray-500">${new Date(message.createdAt).toLocaleDateString()}</p>
                </div>
                <p class="text-sm font-medium text-gray-900 mt-2">${message.subject}</p>
                <p class="text-sm text-gray-500 mt-1">${message.message}</p>
                <div class="mt-2 flex justify-end space-x-2">
                  ${!message.read ? 
                    `<button class="mark-read-btn text-indigo-600 hover:text-indigo-900 text-sm" data-id="${message._id}">
                      Mark as Read
                    </button>` : ''}
                  <button class="delete-message-btn text-red-600 hover:text-red-900 text-sm" data-id="${message._id}">
                    Delete
                  </button>
                </div>
              </li>
            `).join('');
            
            // Add event listeners for mark as read buttons
            document.querySelectorAll('.mark-read-btn').forEach(btn => {
              btn.addEventListener('click', async () => {
                const messageId = btn.getAttribute('data-id');
                try {
                  const response = await fetch(`/api/contacts/${messageId}/read`, {
                    method: 'PATCH',
                    headers: {
                      'Authorization': `Bearer ${token}`
                    }
                  });
                  
                  if (!response.ok) {
                    throw new Error('Failed to mark message as read');
                  }
                  
                  // Reload messages
                  loadTabData('messages');
                } catch (error) {
                  console.error('Error marking message as read:', error);
                }
              });
            });
            
            // Add event listeners for delete message buttons
            document.querySelectorAll('.delete-message-btn').forEach(btn => {
              btn.addEventListener('click', async () => {
                if (!confirm('Are you sure you want to delete this message?')) {
                  return;
                }
                
                const messageId = btn.getAttribute('data-id');
                try {
                  const response = await fetch(`/api/contacts/${messageId}`, {
                    method: 'DELETE',
                    headers: {
                      'Authorization': `Bearer ${token}`
                    }
                  });
                  
                  if (!response.ok) {
                    throw new Error('Failed to delete message');
                  }
                  
                  // Reload messages
                  loadTabData('messages');
                } catch (error) {
                  console.error('Error deleting message:', error);
                }
              });
            });
          } catch (error) {
            console.error('Error loading messages:', error);
          }
          break;
      }
    }
  </script>

  <style>
    .tab-link {
      @apply border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm;
    }
    .active-tab {
      @apply border-indigo-500 text-indigo-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm;
    }
  </style>
</body>
</html> 